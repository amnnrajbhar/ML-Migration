<section class="content-header">
  <h1 class="display-1">
    Gate Entry
    <small></small>
  </h1>
  <ol class="breadcrumb">
    <li><a href="#"><i class="fa fa-database" aria-hidden="true"></i> Home</a></li>
    <li class="active">Gate Entry</li>
  </ol>
</section>
<!-- Main content -->
<section class="content">
  <div class="box">
    <div class="box-header">
      <div class="col-xs-8">
        <h3 class="box-title">Gate Entry Returnable Material</h3>
        <span class="label label-danger" *ngIf="errMsg.length>0">{{errMsg}}</span>
      </div>
      <div class="col-xs-4">
        <button type="button" class="btn btn-primary pull-right" matTooltip="click to gate Entry"
          (click)="onGateEntryActions(false,gateEntryMModel,'new')"><i class="fa fa-plus" aria-hidden="true"></i> Gate
          Entry</button>
        <!-- <div class="pull-right">
          <button type="button" class="btn btn-primary" (click)="onGateEntryActions(false,gateEntryMModel,'new')"
            *ngIf="(currentUser.fkProfileId==1002 || currentUser.fkProfileId==1)"><i class="fa fa-plus"
              aria-hidden="true"></i> Gate Entry</button>&nbsp;&nbsp;
          <button type="button" class="btn btn-primary" (click)="onGateEntryActions(false,gateEntryMModel,'search')"
            *ngIf="(currentUser.fkProfileId==4 || currentUser.fkProfileId==1)"><i class="fa fa-plus"
              aria-hidden="true"></i>
            GI Acknowledge</button>
        </div> -->
      </div>
    </div>
    <div id="dateFilterPanel">
      <div class="row ml-3">
        <div class="col-sm-3">
          <label>GI No</label>
          <div class="form-group form-group-sm">
            <input matTooltip="enter GI NO" name="GINUM" class="form-control" [(ngModel)]="fltrGINO"
              placeholder="GI NO">
          </div>
        </div>
        <div class="col-sm-3">
          <label>Document No</label>
          <div class="form-group form-group-sm">
            <input matTooltip="Enter Document No" name="INVNUM" class="form-control" [(ngModel)]="fltrInvoice"
              placeholder="Document NO">
          </div>
        </div>
        <div class="col-sm-3">
          <div class="form-group form-group-sm">
            <label for="DeliveryMode">Delivery Mode</label>
            <ng-multiselect-dropdown id="fltdeliverymode" name="fltdeliverymode" #fltrdelrymodeEnt="ngModel"
              [placeholder]="'select Delivery Mode(multiple)'" [data]="deliveryModeList" [(ngModel)]="selectedModes"
              [settings]="dropdownSettings" (onDeSelect)="onItemDeSelect($event)" matTooltip="select delivery mode"
              (onDeSelectAll)="onDeSelectAll($event)" (onSelectAll)="onSelectAll($event)">
            </ng-multiselect-dropdown>
          </div>
        </div>
        <div class="col-sm-3">                   
          <label for="plant">Plant</label>
          <select                                           
              [(ngModel)]="plant" class="form-control"
              id="plant" name="plant"  matTooltip="Select Plant"
              ngControl="plant"  >
              <option [ngValue]="undefined" disabled>--Select an Option--</option>
              <option *ngFor="let gate of plantList" [ngValue]="gate.code">
                  {{gate.code}}-{{gate.name}}</option>
          </select>                      
     
        </div>
      </div>
      <div class="row ml-3" *ngIf="currentUser.fkProfileId!=1002">
        <div class="col-sm-3">
          <div class="form-group form-group-sm">
            <label for="DeliveryMode">GI Acknowledge</label>
            <select [(ngModel)]="gIacknowledge" class="form-control" id="gIacknowledge" name="gIacknowledge" matTooltip="select GI acknowledge">
              <option [ngValue]="null">ALL</option>
              <option>Yes</option>
              <option>No</option>
            </select>
          </div>
        </div>
        <div class="col-sm-2">
          <div class="checkbox">
            <label><input type="checkbox" id="chkdelete" name="delete" [(ngModel)]="delete" matTooltip="check to Cancelled GI"><b>Cancelled
                GI</b></label>
          </div>
        </div>
        <div class="col-sm-2">
          <div class="checkbox">
            <label><input type="checkbox" id="chkack" name="ack" [(ngModel)]="acknowledge" matTooltip="check to GI Pending"><b>GI
                Pending</b></label>
          </div>
        </div>
      </div>
      <div class="row ml-3">
        <div class="col-sm-4">
          <label>From Date</label>
          <!-- <input type="date" class="form-control" placeholder="From Date"  [(ngModel)]="from_date"/> -->
          <div class="form-group form-group-sm" [ngClass]="(fromDate.touched && !fromDate.valid)?'has-error':''">
            <input [matTooltipPosition]="'below'" matTooltip="Click to change from date" [owlDateTime]="dt11"
              [owlDateTimeTrigger]="dt11" name="fromDate" class="form-control" [(ngModel)]="from_date"
              #fromDate="ngModel">
            <owl-date-time [pickerType]="'calendar'" #dt11 style="width: 250px;"></owl-date-time>
            <span class="help-block" *ngIf="!fromDate.valid && fromDate.touched">Please enter valid From
              Date.</span>
          </div>
        </div>
        <div class="col-sm-4">
          <label>To Date</label>
          <div class="form-group form-group-sm" [ngClass]="(toDate.touched && !toDate.valid)?'has-error':''">
            <!-- <input type="date" [disabled]="from_date==null||from_date==''" class="form-control" placeholder="To Date"  [(ngModel)]="to_date"> -->
            <input [min]="from_date" [max]="today" [matTooltipPosition]="'below'" matTooltip="Click to change to date"
              [owlDateTime]="dt12" [owlDateTimeTrigger]="dt12" name="endDate" class="form-control" [(ngModel)]="to_date"
              #toDate="ngModel">
            <owl-date-time [pickerType]="'calendar'" #dt12 style="width: 250px;"></owl-date-time>
            <span class="help-block" *ngIf="!toDate.valid && toDate.touched">Please enter valid To
              Date.</span>
          </div>
        </div>
        <div class="col-sm-2">
          <label>&nbsp;</label>
          <div class="form-group form-group-sm">
            <button class="btn btn-primary btn-sm" (click)="getAllGateEntries('load');"
              [disabled]="(!toDate.valid && toDate.touched) || (!fromDate.valid && fromDate.touched)">Go</button>
            &nbsp;&nbsp;
            <button class="btn btn-primary btn-sm" (click)="clearFilter();">Clear</button>
          </div>
        </div>
      </div>
    </div>
    <!-- /.box-header -->
    <div class="box-body table-responsive">
      <table id="userTable" class="table  table-striped" cellspacing="0">
        <thead style="background-color: #0099cc; color:white;">
          <tr>
            <th>SNo</th>
            <th>Financial Year</th>
            <th>GI No</th>
            <!-- <th>Gate No</th> -->
            <th>Doc No</th>
            <th>Doc Date</th>
            <th>Delivery Mode</th>
            <th>In Date</th>
            <th>In Time</th>
            <th>ACK Date</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ge of gateEntryMList; let i = index">
            <td>{{i+1}}</td>
            <td>{{ge.fiN_YEAR}}</td>
            <td>{{ge.gI_NO}}</td>
            <!-- <td>{{ge.gI_GATENO}}</td> -->
            <td>{{ge.doC_NO}}</td>
            <td>{{ge.doC_DATE | date:'dd/MM/yyyy'}}</td>
            <td>{{ge.deliverymode}}</td>
            <td>{{ge.gI_DATE | date:'dd/MM/yyyy'}}</td>
            <td>{{ge.iN_TIME | date:'HH:mm'}}</td>
            <td>{{ge.receiveD_DATE | date:'dd/MM/yyyy'}}</td>
            <td>
              <table>
                <tr>
                  <!-- <td class="pr-2" *ngIf="currentUser.fkProfileId!=1002"><button type="button" [matTooltipPosition]="'after'" matTooltip="Click to delete entry"
                      class="btn btn-primary btn-xs" (click)="onGateEntryActions(true,ge,'edit')"
                      [disabled]="!ge.isActive">
                      <i class="fas fa-trash"></i>
                    </button></td> -->
                  <td><button type="button" class="btn btn-primary btn-xs" [matTooltipPosition]="'after'"
                      matTooltip="Click to Print" (click)="onGateEntryActions(true,ge,'print')"><i
                        class="fa fa-print" aria-hidden="true"></i></button>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
        </tbody>

      </table>
    </div>
    <!-- /.box-body -->
    <div class="overlay" *ngIf="isLoading">
      <i class="fa fa-spinner fa-pulse"></i>
    </div>
  </div>
</section>
<div class="modal fade" id="saveModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
  data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-md  modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="getAllGateEntries('load')">
          <span aria-hidden="true">&times;</span>
        </button>
        <h3 class="modal-title" style="color: #0FB381; text-align: center;"><span class="text pull-center"
            *ngIf="errMsgModalPop.length>0"><i class="fa fa-check"></i>{{errMsgModalPop}}</span></h3>
      </div>
    </div>
  </div>
  <div class="overlay" *ngIf="isLoading">
    <i class="fa fa-spinner fa-pulse"></i>
  </div>
</div>
<!--Security Modal-->
<div class="modal fade" id="myModal" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
  data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header" style="background-color: #68a7d2;color:white;">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h3 class="modal-title">Gate Entry - Returnable Material @{{locationName}}
          <div class="float-right">
            Entry Date and Time - {{today | date:'dd/MM/yyyy HH:mm'}}
          </div>
        </h3>
      </div>
      <div class="modal-body box-primary" style="box-shadow: none;">
        <div class="row">
          <div class="col-sm-12">
            <form #userForm="ngForm">
              <div class="row">
                <div class="col-sm-2">
                  <div class="form-group form-group-sm">
                    <label for="fiscalyr">Financial Year</label>
                    <input type="text" class="form-control" id="usrLName" placeholder="Financial Year"
                      [(ngModel)]="fiscalYear" ngControl="fiscalYear" name="fiscalyr" readonly required />
                  </div>
                </div>
                <div class="col-sm-2">
                  <div class="form-group form-group-sm"
                    [ngClass]="(!gatenumber.valid && gatenumber.touched)?'has-error':''">
                    <label for="gatenumber"><i class="fa fa-times-circle-o"
                        *ngIf="!gatenumber.valid && gatenumber.touched"></i>Gate No<span
                        style="color:red">*</span></label>
                    <select [(ngModel)]="selGateLocation" class="form-control" id="locationGate" name="locationGate"
                      ngControl="selGateLocation" #gatenumber="ngModel" [disabled]="isEdit" matTooltip="select Gate No" required>
                      <option [ngValue]="null" disabled [selected]="true">--Select an Option--</option>
                      <option *ngFor="let gate of locationGateList" [ngValue]="gate">{{gate.gateNo}}</option>
                    </select>
                    <span class="help-block" *ngIf="!gatenumber.valid && gatenumber.touched">Please Enter Gate
                      Number.</span>
                  </div>
                </div>              
                <div class="col-sm-3" *ngIf="!isEdit">
                  <div class="form-group form-group-sm"
                      [ngClass]="(!plantEnt.valid && plantEnt.touched)?'has-error':''">
                      <label for="plant">Plant<span style="color:red">*</span></label>
                      <select                                           
                          [(ngModel)]="plant" class="form-control"
                          id="plant" name="plant"  matTooltip="Select Plant"
                          ngControl="plant" #plantEnt="ngModel"
                          [disabled]="isEdit" required>
                          <option [ngValue]="undefined" disabled>--Select an Option--</option>
                          <option *ngFor="let gate of plantList" [ngValue]="gate.code">
                              {{gate.code}}-{{gate.name}}</option>
                      </select>
                      <span class="help-block"
                          *ngIf="!plantEnt.valid && plantEnt.touched">Please select delivery
                          mode</span>
                  </div>
              </div>
                <div class="col-sm-3" *ngIf="!isEdit">
                  <div class="form-group form-group-sm">
                    <label for="gO_No">GO#<span style="color:red">*</span></label>

                    <input type="text" class="form-control" id="gono" placeholder="GO #" [(ngModel)]="gONo" name="gono"
                      (change)="gONo=gONo.trim()" ngControl="gONo" #gONoEnt="ngModel" matTooltip="enter GO NO" (keydown.enter)="getGONumInfo(gONo)">
                  </div>
                </div>
                <div class="col-1" style="margin-top: 2.3rem;" *ngIf="!isEdit">
                  <button class="btn btn-primary btn-sm" (click)="getGONumInfo(gONo);" matTooltip="click to Go">Go</button>
                </div>
                <div class="col-1 mt-5">
                  <div class="overlay" *ngIf="isLoadingBAPI">
                    <i class="fa fa-spinner fa-pulse"></i>
                  </div>
                </div>
              </div>
              <hr class="m-3">
              <div class="row">
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="doC_NO"> Ref Document No</label>
                    <input [(ngModel)]="gateOutwardMModel.doC_NO" class="form-control" id="project"
                      placeholder="Ref Document Number" name="doC_NO" ngControl="gateOutwardMModel.doC_NO"
                      #doC_NOEnt="ngModel" readonly required>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="doC_DATE"> Ref Document Date</label>
                    <input name="docDate" class="form-control" placeholder="Ref Document Date"
                      value="{{gateOutwardMModel.doC_DATE | date:'dd/MM/yyyy'}}" readonly required>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="supcodEnte"> Supplier Name</label>
                    <input [(ngModel)]="gateOutwardMModel.destinatioN_NM" class="form-control" id="destinatioN_NM"
                      placeholder="Supplier Name" name="destinatioN_NM" ngControl="gateOutwardMModel.destinatioN_NM"
                      #destPlantEnt="ngModel" readonly required>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="expReturnDate"> Expected Return Date
                    </label>
                    <input name="expReturnDate" class="form-control" required placeholder="Expected Return Date"
                      value="{{gateOutwardMModel.exP_RETURN_DATE | date:'dd/MM/yyyy'}}" readonly>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="sendingPerson"> Sending Person</label>
                    <input [(ngModel)]="sendingPersonName" class="form-control" id="supCountry"
                      placeholder="Sending Person" name="supCountry" ngControl="sendingPersonName"
                      #sendinG_PERSONEnt="ngModel" readonly required>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="sendingDept"> Sending Dept Name</label>
                    <input type="text" class="form-control" id="usrid" placeholder="Department"
                      [(ngModel)]="gateOutwardMModel.sendinG_DEPT_NM" name="sendinG_DEPT_NM"
                      ngControl="gateOutwardMModel.sendinG_DEPT_NM" #sendinG_DEPT_NMEnt="ngModel" readonly required>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="purpose">Reason/Purpose</label>
                    <input [(ngModel)]="gateOutwardMModel.sendinG_REASON" class="form-control" id="purpose"
                      placeholder="Reason/Purpose" name="purpose" ngControl="gateOutwardMModel.sendinG_REASON"
                      #purposeEnt="ngModel" readonly>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="inwardTime">Inward Time</label>
                    <input readonly name="endDate" class="form-control"
                      value="{{iN_TIME | date:'dd/MM/yyyy, HH:mm'}}">
                  </div>
                </div>               
              </div>
              <div class="row" >
                <div class="col-sm-3">
                  <div class="form-group form-group-sm"
                    [ngClass]="(!deliverymode.valid && deliverymode.touched)?'has-error':''">
                    <label for="DeliveryMode">Delivery Mode<span style="color:red">*</span></label>
                    <select ng-init="gateEntryMModel.deliverymode = gateEntryMModel.deliverymode || 'none'"
                      [(ngModel)]="gateEntryMModel.deliverymode" class="form-control" id="deliverymode" matTooltip="select delivery mode"
                      name="deliverymode" ngControl="gateEntryMModel.deliverymode" #deliverymode="ngModel"
                      [disabled]="isEdit" required>
                      <option [ngValue]="undefined" disabled>--Select an Option--</option>
                      <option>In Person</option>
                      <option>Courier</option>
                      <option>Vehicle</option>
                    </select>
                    <span class="help-block" *ngIf="!deliverymode.valid && deliverymode.touched">Please select delivery
                      mode</span>
                  </div>
                </div>
                <div class="col-sm-3" *ngIf="gateEntryMModel.deliverymode=='Courier'">
                  <div class="form-group form-group-sm"
                    [ngClass]="(courierName.touched && !courierName.valid)?'has-error':''">
                    <label for="courierName">Courier Name<span style="color:red">*</span>
                    </label>
                    <input [(ngModel)]="gateEntryMModel.courier_Name" class="form-control" placeholder="Courier Name"
                      id="courierName" name="courierName" ngControl="gateEntryMModel.courier_Name" matTooltip="enter courier name"
                      #courierName="ngModel" type="text" [readonly]="isEdit" required>
                    <span class="help-block" *ngIf="!courierName.valid && courierName.touched">Please Enter Courier
                      Name.</span>
                  </div>
                </div>
                <div class="col-sm-3" *ngIf="gateEntryMModel.deliverymode=='Courier'">
                  <div class="form-group form-group-sm"
                    [ngClass]="(courierNum.touched && !courierNum.valid)?'has-error':''">
                    <label for="courierNum">Docket No<span style="color:red">*</span>
                    </label>
                    <input [(ngModel)]="gateEntryMModel.courier_Num" class="form-control" placeholder="Docket No"
                      id="courierNum" (change)="gateEntryMModel.courier_Num=gateEntryMModel.courier_Num.trim()" matTooltip="enter Docket No"
                      name="courierNum" ngControl="gateEntryMModel.courier_Num" #courierNum="ngModel" type="text"
                      [readonly]="isEdit" required>
                    <span class="help-block" *ngIf="!courierNum.valid && courierNum.touched">Please
                      Enter Docket No.</span>
                  </div>
                </div>
                <div class="col-sm-3" *ngIf="gateEntryMModel.deliverymode=='Courier'">
                  <div class="form-group form-group-sm"
                    [ngClass]="(courierDate.touched && !courierDate.valid)?'has-error':''">
                    <label for="courierDate">Docket Date<span style="color:red">*</span>
                    </label>
                    <input [max]="max" [owlDateTime]="dt4" #courierDate="ngModel" required [readonly]="isEdit"
                      [owlDateTimeTrigger]="dt4" name="courierDate" class="form-control" matTooltip="enter Docket Date"
                      [(ngModel)]="gateEntryMModel.courier_Date" placeholder="Docket Date">
                    <owl-date-time [pickerType]="'calendar'" #dt4></owl-date-time>
                    <span class="help-block" *ngIf="!courierDate.valid && courierDate.touched">Please Enter Docket
                      Date.</span>
                  </div>
                </div>
              <!-- </div>
              <div class="row"> -->
                <div class="col-sm-3" *ngIf="gateEntryMModel.deliverymode=='In Person'">
                  <div class="form-group form-group-sm"
                    [ngClass]="(deliveryperson.touched && !deliveryperson.valid)?'has-error':''">
                    <label for="deliveryperson">Delivery Person Name<span style="color:red">*</span>
                    </label>
                    <input [(ngModel)]="gateEntryMModel.deliveryperson" class="form-control" required
                      id="deliveryperson" placeholder="Delivery Person" name="deliveryperson" matTooltip="enter delivery person name"
                      ngControl="gateEntryMModel.deliveryperson" #deliveryperson="ngModel" [readonly]="isEdit">
                    <span class="help-block" *ngIf="!deliveryperson.valid && deliveryperson.touched">Please Enter
                      Delivery Person
                      Name.</span>
                  </div>
                </div>
                <div class="col-sm-3" *ngIf="gateEntryMModel.deliverymode=='Vehicle'">
                  <div class="form-group form-group-sm"
                    [ngClass]="(vehicleNoEnt.touched && !vehicleNoEnt.valid)?'has-error':''">
                    <label for="vehicleNoEnt">Vehicle No<span style="color:red">*</span>
                    </label>
                    <input [(ngModel)]="gateEntryMModel.vehicleno" class="form-control" required id="vehicleNo"
                      placeholder="Vehicle #" name="vehicleNo" ngControl="gateEntryMModel.vehicleno" matTooltip="enter vehicle No"
                      #vehicleNoEnt="ngModel" [readonly]="isEdit">
                    <span class="help-block" *ngIf="!vehicleNoEnt.valid && vehicleNoEnt.touched">Please Enter Vehicle
                      No.</span>
                  </div>
                </div>
                <div class="col-sm-3" *ngIf="gateEntryMModel.deliverymode=='Vehicle'">
                  <div class="form-group form-group-sm">
                      <label for="transporterNameEnt">Transporter Name </label>
                      <input [(ngModel)]="gateEntryMModel.transporterName" class="form-control" 
                          id="transporterName" placeholder="Transporter Name" name="transporterName" matTooltip="Enter Transporter Name"
                          ngControl="gateEntryMModel.transporterName" #transporterNameEnt="ngModel"
                          [readonly]="isEdit">
                     </div>
              </div>
              <div class="col-sm-3" *ngIf="gateEntryMModel.deliverymode=='Vehicle'">
                  <div class="form-group form-group-sm">
                      <label for="lrNoEnt">LR No</label>
                      <input [(ngModel)]="gateEntryMModel.lrNo" class="form-control" 
                          id="lrNo" placeholder="LR No" name="lrNo" matTooltip="Enter LR No"
                          ngControl="gateEntryMModel.lrNo" #lrNoEnt="ngModel"
                          [readonly]="isEdit">                                      
                  </div>
              </div>
              <div class="col-sm-3" *ngIf="gateEntryMModel.deliverymode=='Vehicle'">
                  <div class="form-group form-group-sm">
                      <label for="driverNameEnt">Driver Name</label>
                      <input [(ngModel)]="gateEntryMModel.driverName" class="form-control" 
                          id="driverName" placeholder="Driver Name" name="driverName" matTooltip="Enter Driver Name"
                          ngControl="gateEntryMModel.driverName" #driverNameEnt="ngModel"
                          [readonly]="isEdit">                                     
                  </div>
              </div>
              <div class="col-sm-3">
                <div class="form-group form-group-sm"
                    [ngClass]="(persoN_NAMEEnt.touched && !persoN_NAMEEnt.valid)?'has-error':''">
                    <label for="persoN_NAMEEnt">Received By<span style="color:red">*</span>
                    </label>
                    <input [(ngModel)]="gateEntryMModel.persoN_NAME" class="form-control"
                        placeholder="Received By" id="persoN_NAME"  matTooltip="Enter person name"
                        (keyup)="getpersonResponsible($event)"
                        name="persoN_NAME" ngControl="gateEntryMModel.persoN_NAME" #persoN_NAMEEnt="ngModel"
                        type="text" required [readonly]="isEdit">
                    <span class="help-block"
                        *ngIf="!persoN_NAMEEnt.valid && persoN_NAMEEnt.touched">Please Enter Person
                        Name.</span>
                </div>
            </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="remarks">Remarks</label>
                    <textarea [(ngModel)]="gateEntryMModel.remarks" class="form-control" id="remarks" matTooltip="enter remarks"
                      placeholder="Remarks" name="remarks" ngControl="gateEntryMModel.remarks" maxlength="2000"
                      #remarksEnt="ngModel"></textarea>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm" *ngIf="isEdit"
                    [ngClass]="(reasonEnt.touched && !reasonEnt.valid)?'has-error':''">
                    <label for="reason">Reason for Cancellation<span style="color:red">*</span></label>
                    <input [(ngModel)]="reason" class="form-control" id="reason" placeholder="Reason for Cancellation"
                      name="reason" ngControl="reason" #reasonEnt="ngModel" maxlength="50" matTooltip="enter reason for Cancellation" required>
                    <span class="help-block" *ngIf="!reasonEnt.valid && reasonEnt.touched">Please Enter
                      Reason.</span>
                    <span style="color:red">Reason can allow most 50 characters only</span>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-sm-12">
                  <div class="table-responsive">
                    <table id="personTable" class="table table-bordered" cellspacing="0" style="margin-bottom: 0px;">
                      <thead>
                        <tr>
                          <th>Sl.No</th>
                          <th>Material Type</th>
                          <th>Material Code</th>
                          <th class="col-sm-4">Material Description</th>
                          <th>UOM</th>
                          <th>QTY</th>
                          <th style="width: 10%;" *ngIf="!isEdit">Remaining QTY</th>
                          <th style="width: 12%;">QTY Received</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let per of gateEntryDList; let rec=index">
                          <!-- <ng-container *ngIf="(per.qty-remainingQTY(per))!=0"> -->
                            <td>
                              <label>{{rec+1}}.</label>
                            </td>
                            <td>
                              {{per.materiaL_TYPE}}
                            </td>
                            <td>
                              {{per.iteM_CODE}}
                            </td>
                            <td>
                              {{per.iteM_DESC}}
                            </td>
                            <td>
                              {{per.uom}}
                            </td>
                            <td>
                              {{per.qty}}
                            </td>
                            <td *ngIf="!isEdit">
                              {{per.qty-remainingQTY(per)}}
                            </td>
                            <td>
                              <input class="form-control input-sm" type="number" [name]="'qtY_RCVD'+rec" matTooltip="enter quantity Received"  ng-init="per.qtY_RCVD = 0"
                                [(ngModel)]="per.qtY_RCVD" placeholder="Qty" (change)="validateQTY($event,per)" [required]="(per.qty-remainingQTY(per))!=0"  [readonly]="(per.qty-remainingQTY(per))==0"/>
                            </td>
                          <!-- </ng-container> -->
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="overlay" *ngIf="isLoadingPop">
          <i class="fa fa-spinner fa-pulse"></i>
        </div>
      </div>
      <div class="modal-footer">
        <span class="text-red pull-left" *ngIf="errMsgPop.length>0"><i class="fa fa-warning"></i>{{errMsgPop}}</span>
        <button type="button" class="btn btn-primary" (click)="onSaveEntry()"
          [disabled]="isLoadingPop ||!userForm.valid" matTooltip="click to submit"
          *ngIf="gateEntryMModel.receiveD_DATE==null">{{isEdit==true?'Cancel Entry':'Save'}}</button>
        <button type="button" class="btn btn-default" style="background-color:darkgray;color:white;"
          data-dismiss="modal" [disabled]="isLoadingPop"  matTooltip="click to close modal">Close</button>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>
</div>
<!--Departmet Modal-->
<div class="modal fade" id="depModal" role="dialog" aria-labelledby="depModalLabel" aria-hidden="true"
  data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header" style="background-color: #68a7d2;color:white;">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h3 class="modal-title">Gate Entry - Returnable Material @{{locationName}}
          <div class="float-right">
            Entry Date and Time - {{entryDateTime | date:'dd/MM/yyyy HH:mm'}}
          </div>
        </h3>
      </div>
      <div class="modal-body box-primary" style="box-shadow: none; color:gray">
        <div class="row">
          <div class="col-sm-12">
            <form #depForm="ngForm" (keydown.enter)="$event.preventDefault()">
              <div class="row" *ngIf="!isEdit">
                <div class="col-sm-4">
                  <div class="form-group form-group-sm">
                    <label for="gI_No">GI#<span style="color:red">*</span></label>
                    <input type="text" class="form-control" id="gIno" placeholder="GI #" [(ngModel)]="gINo" name="gIno"
                      (change)="gINo=gINo.trim()" ngControl="gINo" #gINoEnt="ngModel"  matTooltip="enter GI No">
                  </div>
                </div>
                <div class="col-1" style="margin-top: 2.3rem;">
                  <button class="btn btn-primary btn-sm" (click)="getGINumInfo(gINo);"  matTooltip="click to Go">Go</button>
                </div>
                <div class="col-1 mt-5">
                  <div class="overlay" *ngIf="isLoadingBAPI">
                    <i class="fa fa-spinner fa-pulse"></i>
                  </div>
                </div>
              </div>
              <hr class="m-3">
              <div class="row">
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="gatenumber">Gate No</label>
                    <input [(ngModel)]="gateEntryMModel.gI_GATENO" placeholder="Gate No" class="form-control"
                      id="locationGate1" name="locationGate1" type="text" required readonly />
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="fiscalyr">Financial Year</label>
                    <input type="text" class="form-control" id="usrLName1" placeholder="Financial Year"
                      [(ngModel)]="gateEntryMModel.fiN_YEAR" name="fiscalyr1" required readonly />
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="docnumberEnt">Ref Document No
                    </label>
                    <input [(ngModel)]="gateEntryMModel.doC_NO" class="form-control" placeholder="Document No"
                      id="docnumber1" name="docnumber1" type="text" required readonly>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="invoiceDate">Ref Document Date
                    </label>
                    <input name="docdate1" class="form-control" type="text"
                      value="{{gateEntryMModel.doC_DATE | date:'dd/MM/yyyy'}}" placeholder="Document Date" readonly>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="supname"> Supplier Name </label>
                    <input [(ngModel)]="gateOutwardMModel.destinatioN_NM" class="form-control" id="project1"
                      placeholder="Supplier Name" name="supname1" type="text" required readonly>
                  </div>
                </div>

                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="sendingPerson1"> Sending Person</label>
                    <input [(ngModel)]="sendingPersonName" class="form-control" id="supCountry1"
                      placeholder="Sending Person" name="supCountry1" ngControl="sendingPersonName"
                      #sendinG_PERSON1Ent="ngModel" readonly required>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="sendingDept1"> Sending Dept Name</label>
                    <input type="text" class="form-control" id="usrid1" placeholder="Department"
                      [(ngModel)]="gateOutwardMModel.sendinG_DEPT_NM" name="sendinG_DEPT_NM1"
                      ngControl="gateOutwardMModel.sendinG_DEPT_NM" #sendinG_DEPT_NMEnt="ngModel" readonly required>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="purpose1">Reason/Purpose</label>
                    <input [(ngModel)]="gateOutwardMModel.sendinG_REASON" class="form-control" id="purpose1"
                      placeholder="Reason/Purpose" name="purpose1" ngControl="gateOutwardMModel.sendinG_REASON"
                      #purpose1Ent="ngModel" readonly>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="expReturnDate1"> Expected Return Date
                    </label>
                    <input name="expReturnDate1" class="form-control" required placeholder="Expected Return Date"
                      value="{{gateOutwardMModel.exP_RETURN_DATE | date:'dd/MM/yyyy'}}" readonly>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="DeliveryMode">Delivery Mode</label>
                    <input [(ngModel)]="gateEntryMModel.deliverymode" placeholder="Delivery Mode" class="form-control"
                      id="deliverymode1" name="deliverymode1" type="text" required readonly>
                  </div>
                </div>
                <div class="col-sm-3" *ngIf="gateEntryMModel.deliverymode=='In Person'">
                  <div class="form-group form-group-sm">
                    <label for="deliveryperson">Delivery Person Name
                    </label>
                    <input value="{{gateEntryMModel.deliveryperson}}" class="form-control" id="deliveryperson1"
                      placeholder="Delivery Person" name="deliveryperson1" type="text" readonly>
                  </div>
                </div>
                <div class="col-sm-3" *ngIf="gateEntryMModel.deliverymode=='Vehicle'">
                  <div class="form-group form-group-sm">
                    <label for="vehicleNoEnt">Vehicle No
                    </label>
                    <input type="text" value="{{gateEntryMModel.vehicleno}}" class="form-control" id="vehicleNo1"
                      placeholder="Vehicle #" name="vehicleNo1" readonly>
                  </div>
                </div>
                <div class="col-sm-3" *ngIf="gateEntryMModel.deliverymode=='Vehicle'">
                  <div class="form-group form-group-sm">
                      <label for="transporterNameEnt">Transporter Name </label>
                      <input type="text" value="{{gateEntryMModel.transporterName}}" class="form-control"
                      id="transporterName1" placeholder="Transporter Name" name="transporterName1" readonly>
                  </div>
              </div>
              <div class="col-sm-3" *ngIf="gateEntryMModel.deliverymode=='Vehicle'">
                  <div class="form-group form-group-sm">
                      <label for="lrNoEnt">LR No </label>
                      <input type="text" value="{{gateEntryMModel.lrNo}}" class="form-control" 
                          id="lrNo1" placeholder="LR No" name="lrNo1" readonly>                                       
                  </div>
              </div>
              <div class="col-sm-3" *ngIf="gateEntryMModel.deliverymode=='Vehicle'">
                  <div class="form-group form-group-sm">
                      <label for="driverNameEnt">Driver Name</label>
                      <input type="text" value="{{gateEntryMModel.driverName}}" class="form-control" 
                      id="driverName1" placeholder="Driver Name" name="driverName1" readonly>
                  </div>
              </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="inwardTime">Inward Time</label>
                    <input name="inwardTime1" class="form-control" value="{{iN_TIME | date:'dd/MM/yyyy, HH:mm'}}"
                      readonly>
                  </div>
                </div>
              </div>
              <div class="row" *ngIf="gateEntryMModel.deliverymode=='Courier'">
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="courierName">Courier Name
                    </label>
                    <input value="{{gateEntryMModel.courier_Name}}" class="form-control" placeholder="Courier Name"
                      id="courierName1" name="courierName1" type="text" readonly>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="courierNum">Courier Number
                    </label>
                    <input value="{{gateEntryMModel.courier_Num}}" class="form-control" placeholder="Courier Number"
                      id="courierNum1" name="courierNum1" type="text" readonly>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group form-group-sm">
                    <label for="courierDate">Courier Date
                    </label>
                    <input type="text" name="courierDate1" id="courierDate1" class="form-control"
                      value="{{gateEntryMModel.courier_Date | date:'dd/MM/yyyy'}}" placeholder="Courier Date" readonly>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-6">
                  <div class="form-group form-group-sm">
                    <label for="remarks">Remarks</label>
                    <textarea class="form-control" id="remarks1" placeholder="Remarks" name="remarks1"
                      readonly>{{gateEntryMModel.remarks}}</textarea>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-3">
                  <div class="form-group form-group-sm"
                    [ngClass]="(receivedDate.touched && !receivedDate.valid)?'has-error':''">
                    <label for="receivedDate">Received Date<span style="color:red">*</span>
                    </label>
                    <input [max]="today" [owlDateTime]="recdt3" #receivedDate="ngModel" required [owlDateTimeTrigger]="recdt3"
                      name="receivedDate" class="form-control" [(ngModel)]="gateEntryMModel.receiveD_DATE"
                      placeholder="Received Date"  matTooltip="enter received Date">
                    <owl-date-time [pickerType]="'calendar'" #recdt3></owl-date-time>
                    <span class="help-block" *ngIf="!receivedDate.valid && receivedDate.touched">Please Enter received
                      Date.</span>
                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group form-group-sm">
                    <label for="comments">Comments</label>
                    <textarea [(ngModel)]="gateEntryMModel.comments" class="form-control" id="comments"
                      placeholder="comments" name="comments" ngControl="gateEntryMModel.comments" matTooltip="enter comments"
                      #commentsEnt="ngModel"></textarea>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-12">
                  <h3>Material Details</h3>
                  <div class="table-responsive">
                    <table class="table table-bordered" cellspacing="0" style="margin-bottom: 0px;">
                      <thead>
                        <tr>
                          <th>Sl.No</th>
                          <th>Material Type</th>
                          <th>Material Code</th>
                          <th>Material Description</th>
                          <th>UOM</th>
                          <th>QTY</th>
                          <th>Qty Received</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let per of gateEntryDList; let rec=index">
                          <td>
                            <label>{{rec+1}}.</label>
                          </td>
                          <td>
                            {{per.materiaL_TYPE}}
                          </td>
                          <td>
                            {{per.iteM_CODE}}
                          </td>
                          <td>
                            {{per.iteM_DESC}}
                          </td>
                          <td>
                            {{per.uom}}
                          </td>
                          <td>
                            {{per.qty}}
                          </td>
                          <td>
                            {{per.qtY_RCVD}}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="overlay" *ngIf="isLoadingPop">
          <i class="fa fa-spinner fa-pulse"></i>
        </div>
      </div>
      <div class="modal-footer">
        <span class="text-red pull-left" *ngIf="errMsgPop.length>0"><i class="fa fa-warning"></i>{{errMsgPop}}</span>
        <button type="button" class="btn btn-primary" (click)="departmentAcknowledge()"
          [disabled]="isLoadingPop ||!depForm.valid">Save</button>
        <button type="button" class="btn btn-default" style="background-color:darkgray;color:white;"
          data-dismiss="modal" [disabled]="isLoadingPop">Close</button>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>
</div>
<!--Print Modal-->
<div class="modal fade" id="printModal" role="dialog" aria-labelledby="printModalLabel" aria-hidden="true"
  data-backdrop="static" data-keyboard="false">

  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header" style="background-color: #68a7d2;color:white;">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h3 class="modal-title">Gate Entry - Returnable Material @{{locationName}}
        </h3>
      </div>
      <!-- <div class="tabs-container"> -->
      <div class="modal-body box-primary" style="box-shadow: none;">
        <div class="container" id="print-section">
          <div class="row">
            <div class="col-sm-12">
              <div class="row">
                <div class="col-sm-12">
                  <div class="pull-left"><img src="../../assets/dist/img/micrologo.png"></div>
                  <div class="col-sm-7">
                    <h3 class="print-h1">Gate Entry - Returnable Material</h3>
                  </div>
                  <div class="pull-right">
                    <ngx-barcode bc-value="{{gateEntryMModel.gI_NO}}" [bc-display-value]="true" [bc-element-type]="elementtype"
                      [bc-height]="80">
                    </ngx-barcode>
                  </div>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-12">
                  <div class="row">
                    <div class="col-sm-4">
                      <strong>Financial Year: </strong> {{gateEntryMModel.fiN_YEAR}}
                    </div>
                    <div class="col-sm-4">
                      <strong>Document No: </strong> {{gateOutwardMModel.doC_NO}}
                    </div>
                    <div class="col-sm-4">
                      <strong>Document Date: </strong> {{gateOutwardMModel.doC_DATE | date:'dd/MM/yyyy'}}
                    </div>
                    <div class="col-sm-4">
                      <strong>Plant: </strong> {{locationName}}
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-4">
                      <strong>Supplier Name: </strong> {{gateOutwardMModel.destinatioN_NM}}
                    </div>
                    <div class="col-sm-4">
                      <strong>Sending Person: </strong> {{sendingPersonName}}
                    </div>
                    <div class="col-sm-4">
                      <strong>Sending Dept Name: </strong> {{gateOutwardMModel.sendinG_DEPT_NM}}
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-4">
                      <strong>Reason/Purpose: </strong> {{gateOutwardMModel.sendinG_REASON}}
                    </div>
                    <div class="col-sm-4">
                      <strong>Expected Return Date: </strong> {{gateOutwardMModel.exP_RETURN_DATE | date:'dd/MM/yyyy'}}
                    </div>
                    <div class="col-sm-4">
                      <strong>Delivery Mode: </strong> {{gateEntryMModel.deliverymode}}
                    </div>
                  </div>
                  <div class="row" *ngIf="gateEntryMModel.deliverymode=='Courier'">
                    <div class="col-sm-4">
                      <strong>Courier Name: </strong> {{gateEntryMModel.courier_Name}}
                    </div>
                    <div class="col-sm-4">
                      <strong>Docket Number: </strong> {{gateEntryMModel.courier_Num}}
                    </div>
                    <div class="col-sm-4">
                      <strong>Docket Date: </strong> {{gateEntryMModel.courier_Date | date:'dd/MM/yyyy'}}
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-4">
                      <strong>Actual Security Out Time: </strong>
                      {{gateOutwardMModel.ouT_TIME | date:'dd/MM/yyyy, HH:mm'}}
                    </div>
                    <div class="col-sm-4" *ngIf="gateEntryMModel.deliverymode=='Vehicle'">
                      <strong>Vehicle No: </strong> {{gateEntryMModel.vehicleno}}
                    </div>
                    <div class="col-sm-4" *ngIf="gateEntryMModel.deliverymode=='In Person'">
                      <strong>Delivery Person Name: </strong> {{gateEntryMModel.deliveryperson}}
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-4">
                      <strong>Gate No: </strong> {{gateEntryMModel.gI_GATENO}}
                    </div>
                    <div class="col-sm-4">
                      <strong>Inward Date&Time: </strong> {{gateEntryMModel.iN_TIME | date:'dd/MM/yyyy, HH:mm'}}
                    </div>
                    <div class="col-sm-4">
                      <strong>Received By: </strong> {{userName}}
                    </div>
                  </div>
                  <div class="row mt-4">
                    <div class="col-sm-12">
                      <div class="table-responsive">
                        <table class="table table-bordered printtable" cellspacing="0">
                          <thead>
                            <tr>
                              <th>Sl.No</th>
                              <th>Material Type</th>
                              <th>Material Code</th>
                              <th>Material Description</th>
                              <th>UOM</th>
                              <th>Qty</th>
                              <th>Qty Received</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr *ngFor="let per of gateEntryDList; let rec=index">
                              <td>
                                <label>{{rec+1}}.</label>
                              </td>
                              <td>
                                {{per.materiaL_TYPE}}
                              </td>
                              <td>
                                {{per.iteM_CODE}}
                              </td>
                              <td>
                                {{per.iteM_DESC}}
                              </td>
                              <td>
                                {{per.uom}}
                              </td>
                              <td style="text-align: end;">
                                {{per.qty}}
                              </td>
                              <td style="text-align: end;">
                                {{per.qtY_RCVD}}
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="overlay" *ngIf="isLoadingPop">
          <i class="fa fa-spinner fa-pulse"></i>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="print()">Print</button>
        <button type="button" class="btn btn-default" style="background-color:darkgray;color:white;"
          data-dismiss="modal" [disabled]="isLoadingPop">Close</button>
      </div>
    </div>
  </div>
</div>
